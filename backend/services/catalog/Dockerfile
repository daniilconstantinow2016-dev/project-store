# üëá –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–î–ï–°–¨: –º–µ–Ω—è–µ–º 1.22 –Ω–∞ 1.24
FROM golang:1.24-alpine AS builder

WORKDIR /app

COPY go.mod go.sum ./

# –ö–æ–ø–∏—Ä—É–µ–º –ø–∞–ø–∫—É —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ (—á—Ç–æ–±—ã –Ω–µ –∫–∞—á–∞—Ç—å –∏–∑ —Å–µ—Ç–∏)
COPY vendor ./vendor

COPY . .

# –°–æ–±–∏—Ä–∞–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
RUN go build -mod=vendor -o main cmd/app/main.go


# --- –í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ---
FROM alpine:3.20

WORKDIR /root/

RUN apk --no-cache add ca-certificates

# ... (–æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
COPY --from=builder /app/main .
COPY .env .

COPY --from=builder /app/config ./config

EXPOSE 8080

CMD ["./main"]
